!function(e,a){"function"==typeof define&&define.amd?define([],a.bind(this,e,e.videojs)):"undefined"!=typeof module&&module.exports?module.exports=a(e,e.videojs):a(e,e.videojs)}(window,function(e,a){"use strict";e.videojs_dai={version:"0.2"};a.registerPlugin("dai",function(e){var t,i=this,d=i.$(".vjs-tech"),n=!1,r=(i.el(),new Array),o=!1;a.options.autoplay&&(o=!0),d.getAttribute("autoplay")&&(o=!0);var s=a.obj.merge({fallback:"",assetKey:"",source_id:"",video_id:"",liveApiKey:"",apiKey:"",debug:!0},e||{});function l(){(t=t=new google.ima.dai.api.StreamManager(d)).addEventListener(google.ima.dai.api.StreamEvent.Type.LOADED,c,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.ERROR,y,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,f,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,E,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,S,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.STARTED,T,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,v,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.MIDPOINT,u,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,m,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.COMPLETE,g,!1),t.addEventListener(google.ima.dai.api.StreamEvent.Type.CLICK,p,!1)}function v(e){i.trigger("dai",{ad:r,type:"firstQuartile"})}function u(e){i.trigger("dai",{ad:r,type:"midpoint"})}function m(e){i.trigger("dai",{ad:r,type:"thirdQuartile"})}function g(e){i.trigger("dai",{ad:r,type:"complete"})}function p(e){i.trigger("dai",{ad:r,type:"adClick"})}function c(e){i.textTracks().addEventListener("addtrack",function(e){var a=e.track;"metadata"===a.kind&&a.addEventListener("cuechange",function(e){s.debug;var i=a.activeCues[0];if(i&&i.value.data){var d={};d[i.value.key]=i.value.data,d.duration=1/0,t.onTimedMetadata(d)}},!1)},!1),i.src(e.getStreamData().url),o&&i.play()}function y(e){""!=s.fallback&&i.src(s.fallback)}function f(e){var a=e.getStreamData().adProgressData,t=a.adPosition,d=a.totalAds,n=a.currentTime,r=a.duration,o=Math.floor(r-n),s=i.controlBar.el_.querySelector(".vjs-vast-label");s.innerHTML=1==d?"This Ad will end in "+o+"s":"Ad ("+t+" of "+d+") "+o+"s"}function E(e){_(!0)}function S(e){r="undefined",_(!1)}function T(e){var a=e.getAd();(r=new Array).id=a.getAdId(),r.title=a.getTitle(),r.duration=a.getDuration();try{r.url=a.g.g.u}catch(e){}i.trigger("dai",{ad:r,type:"started"})}function _(e){var t=i.controlBar.el_.querySelector(".vjs-vast-label");e?(a.dom.addClass(i.el_,"vjs-dai"),n&&(t.innerHTML="Ad Playing")):(a.dom.removeClass(i.el_,"vjs-dai"),i.adPlaying=!1)}return i.ready(function(){l(),""!=s.assetKey?function(){n=!0;var e=new google.ima.dai.api.LiveStreamRequest;e.assetKey=s.assetKey,e.apiKey=s.liveApiKey||"",t.requestStream(e)}():""!=s.source_id&&""!=s.video_id&&function(){n=!1;var e=new google.ima.dai.api.VODStreamRequest;e.contentSourceId=s.source_id,e.videoId=s.video_id,e.apiKey=s.apiKey||"",t.requestStream(e)}()}),i.dai.requestVODStream=function(e){n=!1,t.reset(),i.reset(),a.dom.removeClass(i.el_,"vjs-dai"),a.dom.removeClass(i.el_,"vjs-has-started"),a.dom.removeClass(i.el_,"vjs-playing"),a.dom.removeClass(i.bigPlayButton.el_,"vjs-no-pointer"),l();var d=new google.ima.dai.api.VODStreamRequest;d.contentSourceId=e.source_id,d.videoId=e.video_id,d.apiKey=e.apiKey||"",t.requestStream(d)},i.dai.requestLivetream=function(e){o=!0,n=!0,t.reset(),i.reset(),a.dom.removeClass(i.el_,"vjs-dai"),a.dom.removeClass(i.el_,"vjs-has-started"),a.dom.removeClass(i.el_,"vjs-playing"),a.dom.removeClass(i.bigPlayButton.el_,"vjs-no-pointer");var d=new google.ima.dai.api.LiveStreamRequest;d.assetKey=e.assetKey,d.apiKey=e.apiKey||"",t.requestStream(d)},this})});